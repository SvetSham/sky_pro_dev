# Виджет личного кабинета клиента банка
## Описание
Виджет предоставляет клиенту банка возможность выполнения таких операций, как отображение нескольких последних успешных банковских операций клиента и другие. Используется обязательная маскировка номера карты или счёта, определяется, какие транзакции проведены, какие отклонены, может быть выполнена сортировка транзакций по дате выполнения.
При использовании виджета необходимо учесть, что номер карты должен содержать 16 цифр, а номер счета - 20 цифр.
## Требования к окружению
Проект создан на ```Python 3.13.0```.
## Установка проекта
- Склонировать репозиторий: ```git@github.com:SvetSham/sky_pro_dev.git```
- Перейти в директорию проекта: ```cd sky_pro_dev```
- Создать и активировать виртуальное окружение:
```python -m venv venv```
```venv\Scripts\activate```
## Установка зависимостей
```pip install -r requirements.txt``` (в данной версии не активно)
## Как запустить проект
```python src/main.py```
## Использование функций
### Модуль masks.py, функция get_mask_card_number
Функция получает на вход номер карты как аргумент в виде целого числа.
На выходе возвращает строковое представление номера карты с замаскированными цифрами. С 7 по 12 цифры скрыты благодаря звёздочкам.
Цифры сгруппированы по 4, группы разделены пробелом.

Пример использования функции:

Вызов:
```print(get_mask_card_number(1596837868705199))```

Результат:
```1596 83** **** 5199```

Обработка сбоев:
- Если функция не получит на входе номера карты, она выбросит исключение ```ValueError``` с сообщением "Вы не ввели номер карты."
- Если функция получит номер карты, содержащий нецифровые символы, то она выбросит исключение ```ValueError``` с сообщением "Номер карты должен содержать только цифры."
- Если номер карты будет короче, чем 16 цифр, то функция выбросит исключение ```ValueError``` с сообщением "Номер карты слишком короткий. Должно быть 16 цифр."
- Если номер карты будет длиннее, чем 16 цифр, то функция выбросит исключение ```ValueError``` с сообщением "Номер карты слишком длинный. Должно быть 16 цифр."


### Модуль masks.py, функция get_mask_account
Функция получает на вход номер счёта как аргумент в виде целого числа.
На выходе возвращает строковое представление номера счёта в виде последних шести цифр, причем из них первые две цифры скрыты благодаря звёздочкам.

Пример использования функции:

Вызов:
```print(get_mask_account(64686473678894779589))```

Результат:
```**9589```

Обработка сбоев:
- Если функция не получит на входе номера счёта, она выбросит исключение ```ValueError``` с сообщением "Вы не ввели номер счёта."
- Если функция получит номер счёта, содержащий нецифровые символы, то она выбросит исключение ```ValueError``` с сообщением "Номер счёта должен содержать только цифры."
- Если номер счёта будет короче, чем 20 цифр, то функция выбросит исключение ```ValueError``` с сообщением "Номер счёта слишком короткий. Должно быть 20 цифр."
- Если номер счёта будет длиннее, чем 20 цифр, то функция выбросит исключение ```ValueError``` с сообщением "Номер счёта слишком длинный. Должно быть 20 цифр."

### Модуль widget.py, функция mask_account_card
Функция возвращает маску для номера карты или счёта. На вход подаётся строка с названием карты или счёта и номером.
На выходе функция выдаёт название карты или счёта и замаскированный номер.

Примеры использования функции:

Вызов:
```print(mask_account_card("Visa Classic 6831982476737658"))```

Результат:
```Visa Classic 6831 98** **** 7658```


Вызов:
```print(mask_account_card("Счет 64686473678894779589"))```

Результат:
```Счет **9589```

Обработка сбоев:
- Если функция на входе не получит номера карты или счёта, она вызовет исключение ```ValueError``` с сообщением "Вы не ввели номер карты." или "Вы не ввели номер счёта." соответственно.
- Если номер карты или счёта содержит какие-либо другие символы, кроме цифр, функция вызовет исключение ```ValueError``` с сообщением "Номер карты / счёта должен содержать только цифры."
- Если функция получит на вход номер карты длиной не 16 цифр или номер счёта длиной не 20 цифр, она вызовет исключение ```ValueError``` с соответствующим сообщением.

### Модуль widget.py, функция get_date
Функция преобразует дату из формата ```'2024-03-11T02:26:18.671407'``` в формат ```'ДД.ММ.ГГГГ'```

Пример использования функции:

Вызов:
```print(get_date("2024-03-11T02:26:18.671407"))```

Результат:
```11.03.2024```

Обработка сбоев:
- Если во входной строке с датой и временем не будет буквы ```T```, функция ```get_date``` выбросит исключение ```ValueError``` с сообщением "Проверьте формат даты."
- Если во входной строке с датой и временем будет указан несуществующий месяц или день, то функция ```get_date``` выбросит исключение ```ValueError``` с сообщением "Проверьте месяц / день в дате."
- Если во входная строка с датой и временем будет пустая то функция ```get_date``` выбросит исключение ```ValueError``` с сообщением "Дата не передана."

### Модуль processing.py, функция filter_by_state
На вход функции подаётся список словарей, содержащих информацию о транзакциях, в том числе состояние - EXECUTED (выполненный) и CANCELED (отменённый).
Вторым параметром передаётся интересующее пользователя состояние (по умолчанию EXECUTED).
Функция фильтрует транзакции по выбранному состоянию и возвращает отфильтрованный список словарей.

Пример использования функции:

```transactions = [```
   
```{"id": 41428829, "state": "EXECUTED", "date": "2019-07-03T18:35:29.512364"},```
    
```{"id": 939719570, "state": "EXECUTED", "date": "2018-06-30T02:08:58.425572"},```
    
```{"id": 594226727, "state": "CANCELED", "date": "2018-09-12T21:27:25.241689"},```
    
```{"id": 615064591, "state": "CANCELED", "date": "2018-10-14T08:21:33.419441"},```

```]```

Вызов:
```print(filter_by_state(transactions))```

Результат:
```[{'id': 41428829, 'state': 'EXECUTED', 'date': '2019-07-03T18:35:29.512364'}, ```
```{'id': 939719570, 'state': 'EXECUTED', 'date': '2018-06-30T02:08:58.425572'}]```

Вызов:
```print(filter_by_state(transactions, "CANCELED"))```

Результат:
```[{'id': 594226727, 'state': 'CANCELED', 'date': '2018-09-12T21:27:25.241689'}, ```
```{'id': 615064591, 'state': 'CANCELED', 'date': '2018-10-14T08:21:33.419441'}]```

### Модуль processing.py, функция sort_by_date
Функция сортирует транзакции по дате по убыванию или по возрастанию. По умолчанию установлена сортировка по убыванию (т. е. сначала самые последние операции).

Пример использования функции (значение transactions смотри выше):

Вызов:
```print(processing.sort_by_date(transactions))```

Результат:

```[{'id': 41428829, 'state': 'EXECUTED', 'date': '2019-07-03T18:35:29.512364'}, ```

```{'id': 615064591, 'state': 'CANCELED', 'date': '2018-10-14T08:21:33.419441'}, ```

```{'id': 594226727, 'state': 'CANCELED', 'date': '2018-09-12T21:27:25.241689'}, ```

```{'id': 939719570, 'state': 'EXECUTED', 'date': '2018-06-30T02:08:58.425572'}]```

Вызов:
```print(processing.sort_by_date(transactions, False))```

Результат:

```[{'id': 939719570, 'state': 'EXECUTED', 'date': '2018-06-30T02:08:58.425572'}, ```

```{'id': 594226727, 'state': 'CANCELED', 'date': '2018-09-12T21:27:25.241689'}, ```

```{'id': 615064591, 'state': 'CANCELED', 'date': '2018-10-14T08:21:33.419441'}, ```

```{'id': 41428829, 'state': 'EXECUTED', 'date': '2019-07-03T18:35:29.512364'}]```

## Тестирование
Чтобы протестировать модуль ```src/masks.py```, необходимо запустить на выполнение модуль ```tests/test_masks.py```.
Содержащиеся в нём функции отвечают за тестирование правильной работы двух функций: ```get_mask_account, get_mask_card_number```.

- Функция ```test_get_mask_card_number_normal``` проверяет создание маски для номера карты, если номер карты указан без ошибок.
- Функция ```test_get_mask_card_number_short``` проверяет, выбрасывает ли функция ```get_mask_card_number``` исключение ```ValueError```, если указан слишком короткий номер карты, а именно меньше 16 цифр.
- Функция ```test_get_mask_card_number_long``` проверяет, выбрасывает ли функция ```get_mask_card_number``` исключение ```ValueError```, если указан слишком длинный номер карты, больше чем 16 цифр.
- Функция ```test_get_mask_card_number_alpha``` проверяет, выбрасывает ли функция ```get_mask_card_number``` исключение ```ValueError```, если в номере карты встречаются другие символы, кроме цифр.
- Функция ```test_get_mask_card_number_default``` проверяет, выбрасывает ли функция ```get_mask_card_number``` исключение ```ValueError```, если номер карты не указан совсем.
- Функция ```test_get_mask_account_normal``` проверяет создание маски номера счёта, если номер счёта указан без ошибок.
- Функция ```test_get_mask_account_short``` проверяет, выбрасывает ли функция ```get_mask_account``` исключение ```ValueError```, если указан слишком короткий номер счёта, а именно меньше 20 цифр.
- Функция ```test_get_mask_account_long``` проверяет, выбрасывает ли функция ```get_mask_account``` исключение ```ValueError```, если указан слишком длинный номер счёта, больше 20 цифр.
- Функция ```test_get_mask_account_alpha``` проверяет, выбрасывает ли функция ```get_mask_account``` исключение ```ValueError```, если в номере счёта встречаются другие символы, кроме цифр.
- Функция ```test_get_mask_account_default``` проверяет, выбрасывает ли функция ```get_mask_account``` исключение ```ValueError```, если номер счёта не указан совсем.

Для тестирования модуля ```src/widget.py``` необходимо использовать модуль ```tests/test_widget.py```.
Он отвечает за тестирование двух функций: ```mask_account_card, get_date```.

- Функция ```test_mask_account_card_normal``` отвечает за тестирование (с использованием параметризации) нормальной работы программы, когда все входные данные о картах и счетах переданы без ошибок.
- Функция ```test_mask_account_card_short``` проверяет, выбрасывает ли функция ```mask_account_card``` исключение ```ValueError```, если указан слишком короткий номер карты (16 цифр) или счёта (20 цифр).
- Функция ```test_mask_account_card_long``` проверяет, выбрасывает ли функция ```mask_account_card``` исключение ```ValueError```, если указан слишком длинный номер карты (16 цифр) или счёта (20 цифр).
- Функция ```test_mask_account_card_alpha``` проверяет, выбрасывает ли функция ```mask_account_card``` исключение ```ValueError```, если номер карты или счёта содержит ещё какие-либо символы, кроме цифр.
- Функция ```test_mask_account_card_default``` проверяет, выбрасывает ли функция ```mask_account_card``` исключение ```ValueError```, если номер карты или счёта не передан.
- Функция ```test_mask_account_card_default``` проверяет, выбрасывает ли функция ```mask_account_card``` исключение ```ValueError```, если номер карты или счёта не передан.
- Функция ```test_get_date_normal``` отвечает за тестирование функции ```get_date```, в том случае, если входные данные переданы без ошибок.
- Функция ```test_get_date_without_t``` проверяет работу функции ```get_date```, в том случае, если в строке, содержащей дату и время, не указана буква ```T```.
- Функция ```test_get_date_wrong_date``` проверяет, выбрасывает ли функция ```get_date``` исключение ```ValueError```, если во входных данных указан несуществующие месяц или день. 
- Функция ```test_get_date_null``` проверяет, выбрасывает ли функция ```get_date``` исключение ```ValueError```, если на её вход не была передана никакая строка с датой и временем.
 
Для тестирования модуля ```src/processing.py``` используется модуль ```tests/test_processing.py```.
Он проверяет правильность работы двух функций: ```filter_by_state, sort_by_date```.

- Функция ```test_filter_by_state_normal``` проверяет правильность работы функции ```filter_by_state``` при правильном формате входных данных - выбор только тех записей о транзакции, статус которых указан во входном параметре ```state```.  
- Функция ```test_filter_by_state_not_found``` проверяет, возвращает ли функция ```filter_by_state``` пустой список, если не были найдены транзакции с указанным статусом.
- Функция ```test_sort_by_date_normal``` проверяет, возвращает ли функция ```sort_by_date``` отсортированные по дате списки словарей с данными о транзациях, отсортированных в прямом порядке (от свежих к давним) или в обратном порядке (от давних к свежим).

Все необходимые наборы данных зафиксированы в соответствующих  фикстурах.
